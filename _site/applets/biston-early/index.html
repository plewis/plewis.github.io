<!DOCTYPE html>
<html lang="en"><head>
    <meta charset="utf-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1"><!-- Begin Jekyll SEO tag v2.6.1 -->
<title>Biston betularia (1848-1898) | Paul O. Lewis Lab Home</title>
<meta name="generator" content="Jekyll v3.8.5" />
<meta property="og:title" content="Biston betularia (1848-1898)" />
<meta property="og:locale" content="en_US" />
<meta name="description" content="This is the web site of Paul O. Lewis, Department of Ecology and Evolutionary Biology, University of Connecticut, Storrs, CT. USA." />
<meta property="og:description" content="This is the web site of Paul O. Lewis, Department of Ecology and Evolutionary Biology, University of Connecticut, Storrs, CT. USA." />
<link rel="canonical" href="http://localhost:4000/applets/biston-early/" />
<meta property="og:url" content="http://localhost:4000/applets/biston-early/" />
<meta property="og:site_name" content="Paul O. Lewis Lab Home" />
<script type="application/ld+json">
{"url":"http://localhost:4000/applets/biston-early/","headline":"Biston betularia (1848-1898)","description":"This is the web site of Paul O. Lewis, Department of Ecology and Evolutionary Biology, University of Connecticut, Storrs, CT. USA.","@type":"WebPage","@context":"https://schema.org"}</script>
<!-- End Jekyll SEO tag -->
<link rel="stylesheet" href="/assets/main.css">
    <link rel="icon" type="image/png" href="/assets/img/favicon.png"><link type="application/atom+xml" rel="alternate" href="http://localhost:4000/feed.xml" title="Paul O. Lewis Lab Home" /><script type="text/javascript" charset="utf-8" src=/assets/js/center-text.js></script> 
    <script type="text/javascript" charset="utf-8" src=/assets/js/lgamma.js></script> 
    <script type="text/javascript" charset="utf-8" src=/assets/js/d3-3d.js></script> 
    <script type="text/javascript" charset="utf-8" src=/assets/js/d3.min.js></script> 
    <script type="text/javascript" charset="utf-8" src=/assets/js/random-0.26.js></script>
    <script type="text/javascript" charset="utf-8" src=/assets/js/POLPanel.js></script>
    <script type="text/javascript" charset="utf-8" src=/assets/js/POLTree.js></script>
    <style type="text/css">
        /* https://stackoverflow.com/questions/826782/how-to-disable-text-selection-highlighting */
        /* <p class="noselect">Unselectable text</p> */
        .noselect {
          -webkit-touch-callout: none; /* iOS Safari */
            -webkit-user-select: none; /* Safari */
             -khtml-user-select: none; /* Konqueror HTML */
               -moz-user-select: none; /* Firefox */
                -ms-user-select: none; /* Internet Explorer/Edge */
                    user-select: none; /* Non-prefixed version, currently
                                          supported by Chrome and Opera */
            }
    </style>
</head>
<body><header class="site-header" role="banner">

  <div class="wrapper"><a class="site-title" rel="author" href="/">Paul O. Lewis Lab Home</a><nav class="site-nav">
        <input type="checkbox" id="nav-trigger" class="nav-trigger" />
        <label for="nav-trigger">
          <span class="menu-icon">
            <svg viewBox="0 0 18 15" width="18px" height="15px">
              <path d="M18,1.484c0,0.82-0.665,1.484-1.484,1.484H1.484C0.665,2.969,0,2.304,0,1.484l0,0C0,0.665,0.665,0,1.484,0 h15.032C17.335,0,18,0.665,18,1.484L18,1.484z M18,7.516C18,8.335,17.335,9,16.516,9H1.484C0.665,9,0,8.335,0,7.516l0,0 c0-0.82,0.665-1.484,1.484-1.484h15.032C17.335,6.031,18,6.696,18,7.516L18,7.516z M18,13.516C18,14.335,17.335,15,16.516,15H1.484 C0.665,15,0,14.335,0,13.516l0,0c0-0.82,0.665-1.483,1.484-1.483h15.032C17.335,12.031,18,12.695,18,13.516L18,13.516z"/>
            </svg>
          </span>
        </label>

        <div class="trigger"><a class="page-link" href="/publications/">Publications</a><a class="page-link" href="/software/">Software</a><a class="page-link" href="/people/">People</a><a class="page-link" href="/teaching/">Teaching</a></div>
      </nav></div>
</header>
<main class="page-content" aria-label="Content">
      <div class="wrapper">
        <h2 id="biston-betularia-peppered-moth"><em>Biston betularia</em> (peppered moth)</h2>
<h3 id="decline-of-the-light-colored-phenotype-from-1848-1898">Decline of the light-colored phenotype from 1848-1898</h3>
<p>Use the slider to set the selection coefficient <em>s</em> in Haldane’s model, which 
assumes that the light-colored (non-melanic) form is selected against with selection coefficient <em>s</em>.</p>

<p>Can you find the value of <em>s</em> that reduces 
the light-colored phenotype from 0.99 down to 0.01 over the 50 year period 1948-1898?
Haldane (1924, p. 26) found the value to be approximately 0.3.</p>

<div id="ctrl" style="width:1000px;text-align:left"></div>
<div id="plot"></div>
<script type="text/javascript">
    // The MIT License (MIT)
    // 
    // Copyright (c) 2018 Paul O. Lewis
    // 
    // Permission is hereby granted, free of charge, to any person obtaining a copy
    // of this software and associated documentation files (the “Software”), to deal
    // in the Software without restriction, including without limitation the rights
    // to use, copy, modify, merge, publish, distribute, sublicense, and/or sell
    // copies of the Software, and to permit persons to whom the Software is
    // furnished to do so, subject to the following conditions:
    // 
    // The above copyright notice and this permission notice shall be included in all
    // copies or substantial portions of the Software.
    // 
    // THE SOFTWARE IS PROVIDED “AS IS”, WITHOUT WARRANTY OF ANY KIND, EXPRESS OR
    // IMPLIED, INCLUDING BUT NOT LIMITED TO THE WARRANTIES OF MERCHANTABILITY,
    // FITNESS FOR A PARTICULAR PURPOSE AND NONINFRINGEMENT. IN NO EVENT SHALL THE
    // AUTHORS OR COPYRIGHT HOLDERS BE LIABLE FOR ANY CLAIM, DAMAGES OR OTHER
    // LIABILITY, WHETHER IN AN ACTION OF CONTRACT, TORT OR OTHERWISE, ARISING FROM,
    // OUT OF OR IN CONNECTION WITH THE SOFTWARE OR THE USE OR OTHER DEALINGS IN THE
    // SOFTWARE.
    // 
    // written by Paul O. Lewis 22-Mar-2019

    // width and height of svg
    var w = 800;
    var h = 600;
    var padding = 80;

    // Model
    var s = 1.0;
    var starting_year = 1848;
    var ending_year = 1898;
    var starting_white_freq = 0.99;
    var white_freq = starting_white_freq;

    // plotting-related
    var brickred = "#B82E2E";
    var nsegments = ending_year - starting_year;
    var linedata = [];

    // axes labels
    var axis_label_height = 12;
    var axis_label_height_pixels = axis_label_height + "px";

    // Select DIV elements already created (see above)
    var ctrl_div = d3.select("div#ctrl");
    var plot_div = d3.select("div#plot");

    // Create SVG element
    var svg = plot_div.append("svg")
        .attr("width", w)
        .attr("height", h);

    // Create rect outlining entire area of SVG
    /*plot_svg.append("rect")
        .attr("x", 0)
        .attr("y", 0)
        .attr("width", w)
        .attr("height", h)
        .attr("fill", "lavender");*/
        
    // Create scale for X axis
    var xscale = d3.scaleLinear()
        .domain([starting_year, ending_year])   // recalculated in refreshPlot()
        .range([padding, w - padding]);

    // Create scale for Y axis
    var yscale = d3.scaleLinear()
        .domain([0, 1])
        .range([h - padding, padding]);

    // Create scale for drawing line segments
    var line_scale = d3.scaleBand()
        .domain(d3.range(nsegments))
        .range(xscale.domain());

    // Function that recalculates the line segments making up the transition probability curve
    function recalcLineData() {
        linedata = [];
        white_freq = starting_white_freq; // frequency of bb genotype (white phenotype)
        let q = Math.sqrt(white_freq);
        let p = 1.0 - q;
        let wBB = 1.0;
        let wBb = 1.0;
        let wbb = 1.0 - s;
        for (var g = 0; g < nsegments; g++) {
            // zygote genotype frequencies (before selection)
            pp = p*p;
            qq = q*q;
            pq2 = 1.0 - pp - qq;
            
            // mean relative fitness
            let wmean = pp*wBB + pq2*wBb + qq*(wbb);
            
            // parental genotype frequencies (after selection)
            pp  = pp*wBB/wmean;                                                   
            pq2 = pq2*wBb/wmean;                                                   
            qq  = qq*wbb/wmean;  
            
            // allele frequencies in gamete pool
            p = pp + pq2/2.0;                                           
            q = 1.0 - p;
            
            // frequency of white phenotype in generation g+1
            white_freq = q*q;                                           
            linedata.push({'x':line_scale(g), 'y':white_freq});
        }
    }
    recalcLineData();

    // Create path representing frequency of white phenotype
    var lineFunc = d3.line()
        .x(function(d) {return xscale(d.x);})
        .y(function(d) {return yscale(d.y);});

    var phenotype_tragectory = svg.append("path")
        .attr("id", "trajectory")
        .attr("d", lineFunc(linedata))
        .attr("fill", "none")
        .attr("stroke", brickred)
        .attr("stroke-width", 2)
        .style("pointer-events", "none");   // don't want line intercepting drag events
        
    // Create text element showing final frequency of white phenotype
    var white_ending_freq = svg.append("text")
        .attr("id", "endfreq")
        .attr("x", w - padding + 20)
        .attr("y", yscale(white_freq))
        .text(" " + white_freq.toFixed(3));

    // Create x axis
    var xaxis = d3.axisBottom(xscale)
        .ticks(5)
        .tickFormat(d3.format("d"));

    // Add x axis to svg
    svg.append("g")
        .attr("id", "xaxis")
        .attr("class", "axis")
        .attr("transform", "translate(0," + (h - padding) + ")")
        .call(xaxis);

    // Style the x-axis
    svg.selectAll('.axis line, .axis path')
        .style('stroke', 'black')
        .style('fill', 'none')
        .style('stroke-width', '1px')
        .style('shape-rendering', 'crispEdges');
    svg.selectAll('g#xaxis g.tick text')
        .style('font-family', 'Helvetica')
        .style('font-size', axis_label_height_pixels);

    // Create y axis
    var yaxis = d3.axisLeft(yscale)
        .ticks(4)
        .tickFormat(d3.format(".2f"));

    // Add y axis to svg
    svg.append("g")
        .attr("id", "yaxis")
        .attr("class", "axis")
        .attr("transform", "translate(" + padding + ",0)")
        .call(yaxis);

    // Style the y-axis
    svg.selectAll('.axis line, .axis path')
        .style('stroke', 'black')
        .style('fill', 'none')
        .style('stroke-width', '1px')
        .style('shape-rendering', 'crispEdges');
    svg.selectAll('g#xaxis g.tick text')
        .style('font-family', 'Helvetica')
        .style('font-size', axis_label_height_pixels);

    var addSlider = function(panel, id, label, starting_value, onfunc) {
        var control_div = panel.append("div").append("div")
            .attr("id", id)
            .attr("class", "control");
        control_div.append("input")
            .attr("id", id)
            .attr("type", "range")
            .attr("name", id)
            .attr("min", "0")
            .attr("max", "100")
            .attr("value", starting_value)
            .on("input", onfunc);
        control_div.append("label")
            .append("label")
            .attr("id", id)
            .html("&nbsp;" + label);
        }
        
    addSlider(ctrl_div, "selcoeff", " s = " + s.toFixed(3), 100.0*s, function() {
        // get percentage from slider position
        var pct = parseFloat(d3.select(this).property('value'));
        
        // get selection coefficient from percentage
        s = pct/100;
        
        // redo calculations with new s
        recalcLineData();
        
        // change the label on the slider
        d3.select("label#selcoeff").text(" s = " + s.toFixed(3));
        
        // change the label at the end of the line showing final white phenotype frequency
        white_ending_freq
            .attr("y", yscale(white_freq))
            .text(" " + white_freq.toFixed(3));
            
        // cause trajectory line to be redrawn by telling phenotype_tragectory
        // about the new linedata
        phenotype_tragectory.attr("d", lineFunc(linedata));
        });
        
    // Add explanatory text
    svg.append("text").attr("id", "info").attr("x", xscale(1860)).attr("y", yscale(0.9)).text("Curve and points show frequency of non-melanic form from 1848 to 1898.");
    svg.append("text").attr("id", "w1").attr("x",   xscale(1860)).attr("y", yscale(0.80)).text("BB fitness = 1");
    svg.append("text").attr("id", "w2").attr("x",   xscale(1860)).attr("y", yscale(0.75)).text("Bb fitness = 1");
    svg.append("text").attr("id", "w3").attr("x",   xscale(1860)).attr("y", yscale(0.70)).text("bb fitness = 1 - s");
    svg.append("text").attr("id", "darkallele").attr("x",  xscale(1870)).attr("y", yscale(0.80)).text("B: dominant melanic allele");
    svg.append("text").attr("id", "lightallele").attr("x", xscale(1870)).attr("y", yscale(0.75)).text("b: recessive non-melanic allele");

</script>


      </div>
    </main><footer class="site-footer h-card">
  <data class="u-url" href="/"></data>

  <div class="wrapper">

    <h2 class="footer-heading">Paul O. Lewis Lab Home</h2>

    <div class="footer-col-wrapper">
      <div class="footer-col footer-col-1">
        <ul class="contact-list">
          <li class="p-name">Paul O. Lewis Lab Home</li><li><a class="u-email" href="mailto:paul.lewis@uconn.edu">paul.lewis@uconn.edu</a></li></ul>
      </div>

      <div class="footer-col footer-col-2"><ul class="social-media-list"><li><a href="https://github.com/plewis"><svg class="svg-icon"><use xlink:href="/assets/minima-social-icons.svg#github"></use></svg> <span class="username">plewis</span></a></li><li><a href="https://www.twitter.com/polewis"><svg class="svg-icon"><use xlink:href="/assets/minima-social-icons.svg#twitter"></use></svg> <span class="username">polewis</span></a></li></ul>
</div>

      <div class="footer-col footer-col-3">
        <p>This is the web site of Paul O. Lewis, Department of Ecology and Evolutionary Biology, University of Connecticut, Storrs, CT. USA.</p>
      </div>
    </div>

  </div>

</footer>
</body>

</html>
