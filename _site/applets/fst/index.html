<!DOCTYPE html>
<html lang="en">

    <script type="text/x-mathjax-config">
        MathJax.Hub.Config({
          tex2jax: {
            inlineMath: [['$','$'], ['\\(','\\)']],
            processEscapes: true
          }
        });
    </script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.0/MathJax.js?config=TeX-AMS-MML_HTMLorMML" type="text/javascript"></script><head>
    <meta charset="utf-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1"><!-- Begin Jekyll SEO tag v2.6.1 -->
<title>Fst and Genetic Drift in Small Populations | Paul O. Lewis Lab Home</title>
<meta name="generator" content="Jekyll v3.8.5" />
<meta property="og:title" content="Fst and Genetic Drift in Small Populations" />
<meta property="og:locale" content="en_US" />
<meta name="description" content="This is the web site of Paul O. Lewis, Department of Ecology and Evolutionary Biology, University of Connecticut, Storrs, CT. USA." />
<meta property="og:description" content="This is the web site of Paul O. Lewis, Department of Ecology and Evolutionary Biology, University of Connecticut, Storrs, CT. USA." />
<link rel="canonical" href="http://localhost:4000/applets/fst/" />
<meta property="og:url" content="http://localhost:4000/applets/fst/" />
<meta property="og:site_name" content="Paul O. Lewis Lab Home" />
<script type="application/ld+json">
{"headline":"Fst and Genetic Drift in Small Populations","url":"http://localhost:4000/applets/fst/","description":"This is the web site of Paul O. Lewis, Department of Ecology and Evolutionary Biology, University of Connecticut, Storrs, CT. USA.","@type":"WebPage","@context":"https://schema.org"}</script>
<!-- End Jekyll SEO tag -->
<link rel="stylesheet" href="/assets/main.css">
    <link rel="icon" type="image/png" href="/assets/img/favicon.png"><link type="application/atom+xml" rel="alternate" href="http://localhost:4000/feed.xml" title="Paul O. Lewis Lab Home" /><script type="text/javascript" charset="utf-8" src=/assets/js/center-text.js></script> 
    <script type="text/javascript" charset="utf-8" src=/assets/js/lgamma.js></script> 
    <script type="text/javascript" charset="utf-8" src=/assets/js/d3-3d.js></script> 
    <script type="text/javascript" charset="utf-8" src=/assets/js/d3.min.js></script> 
    <script type="text/javascript" charset="utf-8" src=/assets/js/mathfn-incbeta.js></script>
    <script type="text/javascript" charset="utf-8" src=/assets/js/random-0.26.js></script>
    <script type="text/javascript" charset="utf-8" src=/assets/js/POLPanel.js></script>
    <script type="text/javascript" charset="utf-8" src=/assets/js/POLTree.js></script>
    <style type="text/css">
        /* https://stackoverflow.com/questions/826782/how-to-disable-text-selection-highlighting */
        /* <p class="noselect">Unselectable text</p> */
        .noselect {
          -webkit-touch-callout: none; /* iOS Safari */
            -webkit-user-select: none; /* Safari */
             -khtml-user-select: none; /* Konqueror HTML */
               -moz-user-select: none; /* Firefox */
                -ms-user-select: none; /* Internet Explorer/Edge */
                    user-select: none; /* Non-prefixed version, currently
                                          supported by Chrome and Opera */
            }
    </style>
</head>
<body><header class="site-header" role="banner">

  <div class="wrapper"><a class="site-title" rel="author" href="/">Paul O. Lewis Lab Home</a><nav class="site-nav">
        <input type="checkbox" id="nav-trigger" class="nav-trigger" />
        <label for="nav-trigger">
          <span class="menu-icon">
            <svg viewBox="0 0 18 15" width="18px" height="15px">
              <path d="M18,1.484c0,0.82-0.665,1.484-1.484,1.484H1.484C0.665,2.969,0,2.304,0,1.484l0,0C0,0.665,0.665,0,1.484,0 h15.032C17.335,0,18,0.665,18,1.484L18,1.484z M18,7.516C18,8.335,17.335,9,16.516,9H1.484C0.665,9,0,8.335,0,7.516l0,0 c0-0.82,0.665-1.484,1.484-1.484h15.032C17.335,6.031,18,6.696,18,7.516L18,7.516z M18,13.516C18,14.335,17.335,15,16.516,15H1.484 C0.665,15,0,14.335,0,13.516l0,0c0-0.82,0.665-1.483,1.484-1.483h15.032C17.335,12.031,18,12.695,18,13.516L18,13.516z"/>
            </svg>
          </span>
        </label>

        <div class="trigger"><a class="page-link" href="/publications/">Publications</a><a class="page-link" href="/software/">Software</a><a class="page-link" href="/people/">People</a><a class="page-link" href="/teaching/">Teaching</a></div>
      </nav></div>
</header>
<main class="page-content" aria-label="Content">
      <div class="wrapper">
        <h2 id="fst-and-genetic-drift-in-small-populations">Fst and genetic drift in small populations</h2>

<p>Key to genotype colors:</p>
<ul>
  <li><img src="https://via.placeholder.com/20.png/FEFF0B/000000?text=+" alt="" /> AA (yellow)</li>
  <li><img src="https://via.placeholder.com/20.png/F08D08/000000?text=+" alt="" /> Aa (orange)</li>
  <li><img src="https://via.placeholder.com/20.png/FF0000/FFFFFF?text=+" alt="" /> aa (red)</li>
</ul>

<p>The frequency of allele <strong>A</strong> used at the start is <em>p</em> = 0.5 for all populations. Refresh your browser to start over.
Scroll down for more details.</p>

<div id="arbitrary"></div>
<script type="text/javascript">
    // The MIT License (MIT)
    // 
    // Copyright (c) 2019 Paul O. Lewis
    // 
    // Permission is hereby granted, free of charge, to any person obtaining a copy
    // of this software and associated documentation files (the “Software”), to deal
    // in the Software without restriction, including without limitation the rights
    // to use, copy, modify, merge, publish, distribute, sublicense, and/or sell
    // copies of the Software, and to permit persons to whom the Software is
    // furnished to do so, subject to the following conditions:
    // 
    // The above copyright notice and this permission notice shall be included in all
    // copies or substantial portions of the Software.
    // 
    // THE SOFTWARE IS PROVIDED “AS IS”, WITHOUT WARRANTY OF ANY KIND, EXPRESS OR
    // IMPLIED, INCLUDING BUT NOT LIMITED TO THE WARRANTIES OF MERCHANTABILITY,
    // FITNESS FOR A PARTICULAR PURPOSE AND NONINFRINGEMENT. IN NO EVENT SHALL THE
    // AUTHORS OR COPYRIGHT HOLDERS BE LIABLE FOR ANY CLAIM, DAMAGES OR OTHER
    // LIABILITY, WHETHER IN AN ACTION OF CONTRACT, TORT OR OTHERWISE, ARISING FROM,
    // OUT OF OR IN CONNECTION WITH THE SOFTWARE OR THE USE OR OTHER DEALINGS IN THE
    // SOFTWARE.
    // 
    // written by Paul O. Lewis 16-April-2019
    
    // Colors
    var genotype_color = ["yellow", "orange", "red"];
    var genotype_stroke = "gray";
    var fstbar_color = "gold";
    var freqplot_color = "blue";
    var line_color = "black";
    var background_color = "floralwhite";

    // width and height of population grid
    var grid_w = 600;
    var grid_h = 600;

    // height of frequency plot area at the top
    var freqplot_h = 100;
    var freqplot_bars = 11;
    var freqplot_data = [];
    for (let b = 0; b < freqplot_bars; b++) {
        freqplot_data.push({"bin":b, "freq":0});
    }

    // height of Fst bar between freqplot and population grid
    var fstbar_h = 30;
    var Fst = 0.0;

    // height of status text area below population grid
    var status_h = 50;
    
    var ngens = 0;

    // There poprows x popcols isolated subpopulations
    var poprows = 4;
    var popcols = 4;
    var npops = poprows*popcols;

    // There indivrows x indivcols diploid individuals per subpopulation
    var tinypop = false;
    var indivrows = 4;
    var indivcols = 4;
    var indiv_data = [];
    
    var popbounds_hidden = false;

    // Dimensions of cells in which individuals are shown
    var wcell = grid_w/(popcols*indivcols);
    var hcell = grid_h/(poprows*indivrows);
    var cell_avg_diam = (wcell + hcell)/2;

    // Radius of circle representing a single individual
    var rindiv = 0.3*cell_avg_diam;

    // Determines amount of Gaussian jigger to impart to each individual's position
    var jigger_stdev = 0.3*cell_avg_diam;

    // scale for frequency plot at top
    var pscale = d3.scaleBand(
        [0, freqplot_bars-1],
        [0, grid_w]);

    // Initialize frequency of A allele in all subpopulations
    var Ho = 0.0;
    var He = 0.0;
    var heterozygosity = [];
    var freqA = [];
    var pbar = 0.0;
    for (let i = 0; i < poprows; i++) {
        for (let j = 0; j < popcols; j++) {
            let tmp = {"i":i, "j":j, "freq":0.5};
            freqA.push(tmp);
            heterozygosity.push({"i":i, "j":j, "heterozygosity":0.0});
        }
    }
    
    function resetFreqPlotData() {
        for (let b = 0; b < freqplot_bars; b++) {
            freqplot_data[b].freq = 0;
        }
    }

    // Returns index into data vector of individual on row indivrow, column indivcol,
    // in the subpopulation at row poprow and column popcol. 
    function getDataIndex(poprow, popcol, indivrow, indivcol) {
        return poprow*popcols*indivrows*indivcols + popcol*indivrows*indivcols + indivrow*indivcols + indivcol;
    }

    // Randomly draw a genotype given frequencies of AA, Aa, and aa.
    function drawOneGenotype(pp, pq2, qq) {
        let u = Math.random();
        if (u < pp)
            return 0;
        else if (u < pp + pq2)
            return 1;
        else
            return 2;
    }

    function tallyFreq(f) {
        let bin = Math.floor(f*(freqplot_bars-1));
        freqplot_data[bin].freq++;
    }

    // Draw n genotypes for subpop at row i, column j
    // and recompute freqA for that subpop using the new genotypes
    function drawNGenotypes(i, j, n, initialize) {
        let k = i*popcols + j;
        let v = [];
        if (initialize) {
            let nindivs = indivrows*indivcols;
            let nAA = Math.floor(0.25*nindivs);
            let nAa = Math.floor(0.5*nindivs);
            let naa = Math.floor(0.25*nindivs);
            if (nAA + nAa + naa != nindivs) {
                console.log("ERROR: number of individuals in each population should be a multiple of 4");
            }
            for (let i = 0; i < nAA; i++) {
                v.push(0);
            }
            for (let i = 0; i < nAa; i++) {
                v.push(1);
            }
            for (let i = 0; i < naa; i++) {
                v.push(2);
            }
            let indx = i*popcols + j;
            freqA[indx].freq = 0.5;
            tallyFreq(0.5);
            heterozygosity[i*popcols + j].heterozygosity = 0.5;
        }
        else {
            let p = freqA[k].freq;
            let pp = p*p;
            let pq2 = 2.0*p*(1.0-p);
            let qq = 1.0 - pp - pq2;
            let pcount = 0;
            let qcount = 0;
            let hcount = 0;
            for (k = 0; k < n; k++) {
                let g = drawOneGenotype(pp, pq2, qq);
                v.push(g);
                if (g == 0) {
                    pcount++;
                    pcount++;
                    }
                else if (g == 1) {
                    pcount++;
                    qcount++;
                    hcount++;
                    }
                else {
                    qcount++;
                    qcount++;
                    }
            }
            let total_count = pcount + qcount;
            let indx = i*popcols + j;
            freqA[indx].freq = pcount/total_count;
            tallyFreq(freqA[indx].freq);
            heterozygosity[i*popcols + j].heterozygosity = hcount/n;
        }
        return v;
    }   

    function getCellX(popcol, indivcol) {
        return wcell*(popcol*indivcols + indivcol + 0.5);
    }       

    function getCellY(poprow, indivrow) {
        return freqplot_h + fstbar_h + hcell*(poprow*indivrows + indivrow + 0.5);
    }       

    // Data for individuals is stored as list of objects containing information about each individual
    function initializePops() {
        ngens = 0;
        indiv_data = [];
        Ho = 0.0;
        pbar = 0.0;
        resetFreqPlotData();
        for (let i = 0; i < poprows; i++) {
            for (let j = 0; j < popcols; j++) {
                let n = indivrows*indivcols;
                let v = drawNGenotypes(i, j, n, true);
                Ho += heterozygosity[i*popcols + j].heterozygosity;
                pbar += freqA[i*popcols + j].freq;
                for (let k = 0; k < indivrows; k++) {
                    for (let m = 0; m < indivcols; m++) {
                        let x = getCellX(j, m);
                        let y = getCellY(i, k);
                        indiv_data.push({"i":i, "j":j, "k":k, "m":m, "x":x, "y":y, "genotype":v[k*indivcols + m]});
                    }
                }
            }
        }
        Ho /= (poprows*popcols);
        pbar /= (poprows*popcols);
    }
    initializePops();

    function getStatusText() {
        return "g = " + ngens + ", pmean = " + pbar.toFixed(3) + ", Ho = " + Ho.toFixed(3) + ", He = " + He.toFixed(3) + ", Fst = " + Fst.toFixed(3);
    }

    function recalcFst() {
        let sumsq = 0.0;
        let sum = 0.0;
        let n = freqA.length;
        for (let i = 0; i < n; i++) {
            let x = freqA[i].freq;
            sum += x;
            sumsq += x*x;
        }
        let mean = sum/n;
        let variance = (sumsq - n*mean*mean)/n;
        let maxvar = mean*(1-mean);
        Fst = variance/maxvar;
    }

    function nextGeneration() {
        ngens++;
        resetFreqPlotData();
        Ho = 0.0;
        pbar = 0.0;
        for (let i = 0; i < poprows; i++) {
            for (let j = 0; j < popcols; j++) {
                let n = indivrows*indivcols;
                let v = drawNGenotypes(i, j, n, false);
                Ho += heterozygosity[i*popcols + j].heterozygosity;
                pbar += freqA[i*popcols + j].freq;
                for (let k = 0; k < indivrows; k++) {
                    for (let m = 0; m < indivcols; m++) {
                        let x = getCellX(j, m);
                        let y = getCellY(i, k);
                        let indiv = getDataIndex(i, j, k, m);
                        indiv_data[indiv].genotype = v[k*indivcols + m];
                    }
                }
            }
        }
        Ho /= (poprows*popcols);
        pbar /= (poprows*popcols);
        He = 2.0*pbar*(1.0 - pbar);
        recalcFst();
        d3.select("rect#fst")
            .attr("width", grid_w*Fst)
            .attr("fill", fstbar_color);
        d3.selectAll("rect.hist")
            .attr("x", function(d) {return d.bin*grid_w/freqplot_bars;})
            .attr("y", function(d) {return freqplot_h - d.freq*freqplot_h/npops;})
            .attr("height", function(d) {return d.freq*freqplot_h/npops;})
            .attr("fill", freqplot_color);
        d3.selectAll("circle.indiv")
            .attr("cx", function(d) {return d.x;})
            .attr("cy", function(d) {return d.y;})
            .attr("fill", function(d) {return genotype_color[d.genotype];});
        d3.select("text#status")
            .text(getStatusText())
        CenterTextInRect(status_text, 0, freqplot_h, grid_w, fstbar_h);
    }

    // Data for lines separating populations
    var line_data = [];
    for (let i = 0; i < poprows + 1; i++) {
        let x1 = 0;
        let x2 = grid_w;
        let y1 = freqplot_h + fstbar_h + (grid_h/poprows)*i;
        let y2 = freqplot_h + fstbar_h + (grid_h/poprows)*i;
        line_data.push({"x1":x1, "x2":x2, "y1":y1, "y2":y2});
    }
    for (let j = 0; j < popcols + 1; j++) {
        let x1 = (grid_w/popcols)*j;
        let x2 = (grid_w/popcols)*j;
        let y1 = freqplot_h + fstbar_h;
        let y2 = freqplot_h + fstbar_h + grid_h;
        line_data.push({"x1":x1, "x2":x2, "y1":y1, "y2":y2});
    }

    function CenterTextInRect(text_element, x, y, w, h) {
        // center text_element horizontally
        text_element.attr("text-anchor", "middle");
        text_element.attr("x", x + w/2);

        // center text_element vertically
        text_element.attr("y", 0);
        var bb = text_element.node().getBBox();
        var descent = bb.height + bb.y;
        text_element.attr("y", y + h/2 + bb.height/2 - descent);
        }

    // Listen and react to keystrokes
    function keyDown() {
        console.log("key was pressed: " + d3.event.keyCode);
        if (d3.event.keyCode == 78) {
            // 78 is the "n" key
            nextGeneration();
        }
        else if (d3.event.keyCode == 72) {
            // 72 is the "h" key
            if (popbounds_hidden) {
                d3.selectAll("line.popbounds").style("visibility", "visible");
                popbounds_hidden = false;
            }
            else {
                d3.selectAll("line.popbounds").style("visibility", "hidden");
                popbounds_hidden = true;
            }
        }
        else if (d3.event.keyCode == 83) {
            // 83 is the "s" key
            if (tinypop) {
                tinypop = false;
                indivrows = 4;
                indivcols = 4;
            }
            else {
                tinypop = true;
                indivrows = 2;
                indivcols = 2;
            }
            
            wcell = grid_w/(popcols*indivcols);
            hcell = grid_h/(poprows*indivrows);
            cell_avg_diam = (wcell + hcell)/2;
            
            d3.selectAll("circle.indiv").remove();
            initializePops();
            plot_svg.selectAll("circle.indiv")
                .data(indiv_data)
                .enter()
                .append("circle")
                .attr("class", "indiv")
                .attr("cx", function(d) {return d.x;})
                .attr("cy", function(d) {return d.y;})
                .attr("r", rindiv)
                .attr("fill", function(d) {return genotype_color[d.genotype];})
                .attr("stroke", genotype_stroke);
        }
    }
    d3.select("body")
        .on("keydown", keyDown);

    // Select DIV element already created (see above) to hold SVG
    var plot_div = d3.select("div#arbitrary");

    // Create SVG element
    var plot_svg = plot_div.append("svg")
        .attr("width", grid_w)
        .attr("height", grid_h + freqplot_h + fstbar_h);

    // Create rect outlining entire area of SVG
    plot_svg.append("rect")
        .attr("x", 0)
        .attr("y", 0)
        .attr("width", grid_w)
        .attr("height", grid_h + freqplot_h + fstbar_h)
        .attr("fill", background_color);

    // Create rectangle representing Fst bar
    plot_svg.append("rect")
        .attr("id", "fst")
        .attr("x", 0)
        .attr("y", freqplot_h)
        .attr("width", 0)
        .attr("height", fstbar_h)
        .attr("fill", fstbar_color)
        .attr("stroke", "none");

    // Create rectangles representing freqplot bars
    plot_svg.selectAll("rect.hist")
        .data(freqplot_data)
        .enter()
        .append("rect")
        .attr("class", "hist")
        .attr("x", function(d) {return d.bin*grid_w/freqplot_bars;})
        .attr("y", function(d) {return freqplot_h - d.freq*freqplot_h/npops;})
        .attr("width", grid_w/freqplot_bars)
        .attr("height", function(d) {return d.freq*freqplot_h/npops;})
        .attr("fill", freqplot_color)
        .attr("stroke", "none");

    // Create circles representing individuals
    plot_svg.selectAll("circle.indiv")
        .data(indiv_data)
        .enter()
        .append("circle")
        .attr("class", "indiv")
        .attr("cx", function(d) {return d.x;})
        .attr("cy", function(d) {return d.y;})
        .attr("r", rindiv)
        .attr("fill", function(d) {return genotype_color[d.genotype];})
        .attr("stroke", genotype_stroke);

    // Create lines separating populations
    plot_svg.selectAll("line.popbounds")
        .data(line_data)
        .enter()
        .append("line")
        .attr("class", "popbounds")
        .attr("x1", function(d) {return d.x1;})
        .attr("y1", function(d) {return d.y1;})
        .attr("x2", function(d) {return d.x2;})
        .attr("y2", function(d) {return d.y2;})
        .attr("stroke", line_color);

    var status_text = plot_svg.append("text")
        .attr("id", "status")
        .attr("x", 0)
        .attr("y", 0)
        .attr("font-family", "Verdana")
        .attr("font-size", "12pt")
        .text(getStatusText())
    CenterTextInRect(status_text, 0, freqplot_h, grid_w, fstbar_h);                 
</script>

<p>The following keys do something:</p>
<ul>
  <li>‘n’ advances to the next generation</li>
  <li>’s’ toggles between 4 and 16 diploid individuals per population</li>
  <li>‘h’ hides population boundaries</li>
</ul>

<p>The status text shows:</p>
<ul>
  <li><strong>g</strong> = the number of generations of random mating within populations</li>
  <li><strong>pmean</strong> = mean frequency of the A allele (<em>p</em>) over all populations</li>
  <li><strong>Ho</strong> = observed heterozygosity = fraction of heterozygotes over all populations</li>
  <li><strong>He</strong> = expected heterozygosity = expected fraction of heterozygotes = 2 pmean (1-pmean)</li>
  <li><strong>Fst</strong> = variance of <em>p</em> across populations divided by pmean (1 - pmean), which is the maximum possible variance of <em>p</em> across populations</li>
</ul>

<p>The <strong>blue histogram</strong> at the top shows the distribution of <em>p</em> over the 12 populations (<em>p</em> = 0 at far left, <em>p</em> = 1 at far right).</p>

<p>With each new generation, drift increases the variance of <em>p</em> across populations and thus 
increases <strong>Fst</strong> (indicated by the fraction of the status bar filled with <strong>orange</strong>) until, eventually, 
all populations are fixed for either the <strong>A</strong> or the <strong>a</strong> allele, the variance of <em>p</em> is 
as large as it can get, and <strong>Fst</strong> equals 1.</p>

      </div>
    </main><footer class="site-footer h-card">
  <data class="u-url" href="/"></data>

  <div class="wrapper">

    <h2 class="footer-heading">Paul O. Lewis Lab Home</h2>

    <div class="footer-col-wrapper">
      <div class="footer-col footer-col-1">
        <ul class="contact-list">
          <li class="p-name">Paul O. Lewis Lab Home</li><li><a class="u-email" href="mailto:paul.lewis@uconn.edu">paul.lewis@uconn.edu</a></li></ul>
      </div>

      <div class="footer-col footer-col-2"><ul class="social-media-list"><li><a href="https://github.com/plewis"><svg class="svg-icon"><use xlink:href="/assets/minima-social-icons.svg#github"></use></svg> <span class="username">plewis</span></a></li><li><a href="https://www.twitter.com/polewis"><svg class="svg-icon"><use xlink:href="/assets/minima-social-icons.svg#twitter"></use></svg> <span class="username">polewis</span></a></li></ul>
</div>

      <div class="footer-col footer-col-3">
        <p>This is the web site of Paul O. Lewis, Department of Ecology and Evolutionary Biology, University of Connecticut, Storrs, CT. USA.</p>
      </div>
    </div>

  </div>

</footer>
</body>

</html>
