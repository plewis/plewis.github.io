<!DOCTYPE html>
<html lang="en">

    <script type="text/x-mathjax-config">
        MathJax.Hub.Config({
          tex2jax: {
            inlineMath: [['$','$'], ['\\(','\\)']],
            processEscapes: true
          }
        });
    </script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.0/MathJax.js?config=TeX-AMS-MML_HTMLorMML" type="text/javascript"></script><head>
    <meta charset="utf-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1"><!-- Begin Jekyll SEO tag v2.8.0 -->
<title>Biston betularia (1959-2003) | Paul O. Lewis Lab Home</title>
<meta name="generator" content="Jekyll v3.9.1" />
<meta property="og:title" content="Biston betularia (1959-2003)" />
<meta property="og:locale" content="en_US" />
<meta name="description" content="This is the web site of Paul O. Lewis, Department of Ecology and Evolutionary Biology, University of Connecticut, Storrs, CT. USA." />
<meta property="og:description" content="This is the web site of Paul O. Lewis, Department of Ecology and Evolutionary Biology, University of Connecticut, Storrs, CT. USA." />
<link rel="canonical" href="http://localhost:4000/applets/biston-late/" />
<meta property="og:url" content="http://localhost:4000/applets/biston-late/" />
<meta property="og:site_name" content="Paul O. Lewis Lab Home" />
<meta property="og:type" content="website" />
<meta name="twitter:card" content="summary" />
<meta property="twitter:title" content="Biston betularia (1959-2003)" />
<script type="application/ld+json">
{"@context":"https://schema.org","@type":"WebPage","description":"This is the web site of Paul O. Lewis, Department of Ecology and Evolutionary Biology, University of Connecticut, Storrs, CT. USA.","headline":"Biston betularia (1959-2003)","url":"http://localhost:4000/applets/biston-late/"}</script>
<!-- End Jekyll SEO tag -->
<link rel="stylesheet" href="/assets/main.css">
    <link rel="icon" type="image/png" href="/assets/img/favicon.png"><link type="application/atom+xml" rel="alternate" href="http://localhost:4000/feed.xml" title="Paul O. Lewis Lab Home" /><script type="text/javascript" charset="utf-8" src=/assets/js/center-text.js></script> 
    <script type="text/javascript" charset="utf-8" src=/assets/js/lgamma.js></script> 
    <script type="text/javascript" charset="utf-8" src=/assets/js/d3-3d.js></script> 
    <script type="text/javascript" charset="utf-8" src=/assets/js/d3.min.js></script> 
    <script type="text/javascript" charset="utf-8" src=/assets/js/mathfn-incbeta.js></script>
    <script type="text/javascript" charset="utf-8" src=/assets/js/random-0.26.js></script>
    <script type="text/javascript" charset="utf-8" src=/assets/js/POLPanel.js></script>
    <script type="text/javascript" charset="utf-8" src=/assets/js/POLTree.js></script>
    <style type="text/css">
        /* https://stackoverflow.com/questions/826782/how-to-disable-text-selection-highlighting */
        /* <p class="noselect">Unselectable text</p> */
        .noselect {
          -webkit-touch-callout: none; /* iOS Safari */
            -webkit-user-select: none; /* Safari */
             -khtml-user-select: none; /* Konqueror HTML */
               -moz-user-select: none; /* Firefox */
                -ms-user-select: none; /* Internet Explorer/Edge */
                    user-select: none; /* Non-prefixed version, currently
                                          supported by Chrome and Opera */
            }
    </style>
</head>
<body><header class="site-header" role="banner">

  <div class="wrapper"><a class="site-title" rel="author" href="/">Paul O. Lewis Lab Home</a><nav class="site-nav">
        <input type="checkbox" id="nav-trigger" class="nav-trigger" />
        <label for="nav-trigger">
          <span class="menu-icon">
            <svg viewBox="0 0 18 15" width="18px" height="15px">
              <path d="M18,1.484c0,0.82-0.665,1.484-1.484,1.484H1.484C0.665,2.969,0,2.304,0,1.484l0,0C0,0.665,0.665,0,1.484,0 h15.032C17.335,0,18,0.665,18,1.484L18,1.484z M18,7.516C18,8.335,17.335,9,16.516,9H1.484C0.665,9,0,8.335,0,7.516l0,0 c0-0.82,0.665-1.484,1.484-1.484h15.032C17.335,6.031,18,6.696,18,7.516L18,7.516z M18,13.516C18,14.335,17.335,15,16.516,15H1.484 C0.665,15,0,14.335,0,13.516l0,0c0-0.82,0.665-1.483,1.484-1.483h15.032C17.335,12.031,18,12.695,18,13.516L18,13.516z"/>
            </svg>
          </span>
        </label>

        <div class="trigger"><a class="page-link" href="/publications/">Publications</a><a class="page-link" href="/software/">Software</a><a class="page-link" href="/people/">People</a><a class="page-link" href="/teaching/">Teaching</a></div>
      </nav></div>
</header>
<main class="page-content" aria-label="Content">
      <div class="wrapper">
        <h2 id="biston-betularia-peppered-moth"><em>Biston betularia</em> (peppered moth)</h2>
<h3 id="decline-of-the-melanic-phenotype-from-1959-to-2003">Decline of the melanic phenotype from 1959 to 2003</h3>
<p>Use the slider to set the selection coefficient <em>s</em> in the model, which 
assumes that the melanic form is selected against with selection coefficient <em>s</em>.</p>

<p>Can you find a single value of <em>s</em> that matches the points, which measure the 
frequency of the melanic form each year in a single place (<a href="https://goo.gl/maps/h9QniAYgzRr">West Kirby, near Liverpool, 
England</a>). You may find that allowing the selection coefficient to change in 1976 helps 
in fitting the model to the empirical measurements. Does the best fitting model assume a 
constant selection coefficient, increasing selection against the melanic form, or 
decreasing selection against the melanic form?</p>

<div id="ctrl"></div>
<div id="plot"></div>
<script type="text/javascript">
    // The MIT License (MIT)
    // 
    // Copyright (c) 2018 Paul O. Lewis
    // 
    // Permission is hereby granted, free of charge, to any person obtaining a copy
    // of this software and associated documentation files (the “Software”), to deal
    // in the Software without restriction, including without limitation the rights
    // to use, copy, modify, merge, publish, distribute, sublicense, and/or sell
    // copies of the Software, and to permit persons to whom the Software is
    // furnished to do so, subject to the following conditions:
    // 
    // The above copyright notice and this permission notice shall be included in all
    // copies or substantial portions of the Software.
    // 
    // THE SOFTWARE IS PROVIDED “AS IS”, WITHOUT WARRANTY OF ANY KIND, EXPRESS OR
    // IMPLIED, INCLUDING BUT NOT LIMITED TO THE WARRANTIES OF MERCHANTABILITY,
    // FITNESS FOR A PARTICULAR PURPOSE AND NONINFRINGEMENT. IN NO EVENT SHALL THE
    // AUTHORS OR COPYRIGHT HOLDERS BE LIABLE FOR ANY CLAIM, DAMAGES OR OTHER
    // LIABILITY, WHETHER IN AN ACTION OF CONTRACT, TORT OR OTHERWISE, ARISING FROM,
    // OUT OF OR IN CONNECTION WITH THE SOFTWARE OR THE USE OR OTHER DEALINGS IN THE
    // SOFTWARE.
    // 
    // written by Paul O. Lewis 22-Mar-2019
    
    // Data from Clarke, Cyril A., Bruce Grant, Frieda M. M. Clarke, and 
    // Takahiro Asami. 1994. A long term assessment of Biston betularia (L.)
    // in one UK locality (Caldy Common near West Kirby, Wirral), 1959-1993, 
    // and glimpses elsewhere. The Linnean 10(2):18-26. Appendix I.
    // Data from mercury vapor lights only. Values after 1993 obtained by 
    // eye-balling Figure 2 in Cook, Laurence M. 2003. The rise and fall of 
    // the carbonaria form of the peppered moth. Quarterly Review of Biology 
    // 78(4): 399-417.
    var fraction_carbonaria = [
        {'year':1959, 'fraction':0.933},
        {'year':1960, 'fraction':0.942},
        {'year':1961, 'fraction':0.934},
        {'year':1962, 'fraction':0.929},
        {'year':1963, 'fraction':0.912},
        {'year':1964, 'fraction':0.902},
        {'year':1965, 'fraction':0.900},
        {'year':1966, 'fraction':0.925},
        {'year':1967, 'fraction':0.922},
        {'year':1968, 'fraction':0.893},
        {'year':1969, 'fraction':0.933},
        {'year':1970, 'fraction':0.913},
        {'year':1971, 'fraction':0.899},
        {'year':1972, 'fraction':0.895},
        {'year':1973, 'fraction':0.890},
        {'year':1974, 'fraction':0.878},
        {'year':1975, 'fraction':0.872},
        {'year':1976, 'fraction':0.846},
        {'year':1977, 'fraction':0.897},
        {'year':1978, 'fraction':0.830},
        {'year':1979, 'fraction':0.864},
        {'year':1980, 'fraction':0.763},
        {'year':1981, 'fraction':0.660},
        {'year':1982, 'fraction':0.721},
        {'year':1983, 'fraction':0.637},
        {'year':1984, 'fraction':0.608},
        {'year':1985, 'fraction':0.523},
        {'year':1986, 'fraction':0.470},
        {'year':1987, 'fraction':0.423},
        {'year':1988, 'fraction':0.408},
        {'year':1989, 'fraction':0.295},
        {'year':1990, 'fraction':0.331},
        {'year':1991, 'fraction':0.269},
        {'year':1992, 'fraction':0.235},
        {'year':1993, 'fraction':0.232},
        {'year':1994, 'fraction':0.19},
        {'year':1995, 'fraction':0.18},
        {'year':1996, 'fraction':0.09},
        {'year':1997, 'fraction':0.08},
        {'year':1998, 'fraction':0.12},
        {'year':1999, 'fraction':0.05},
        {'year':2000, 'fraction':0.10},
        {'year':2001, 'fraction':0.06},
        {'year':2002, 'fraction':0.02}
        ];

    // width and height of svg
    var w = 800;
    var h = 600;
    var padding = 80;
    var dot_radius = 2;

    // Model
    var s0 = 1.0;
    var s1 = 1.0;
    var slinked = true;
    var starting_year = 1959;
    var switch_year = 1976;
    var ending_year = 2002;
    var starting_melanic_freq = 0.933;
    var melanic_freq = starting_melanic_freq;

    // plotting-related
    var brickred = "#B82E2E";
    var nsegments = ending_year - starting_year;
    var linedata = [];

    // axes labels
    var axis_label_height = 12;
    var axis_label_height_pixels = axis_label_height + "px";

    // Select DIV elements already created (see above)
    var ctrl_div = d3.select("div#ctrl");
    var plot_div = d3.select("div#plot");

    // Create SVG element
    var svg = plot_div.append("svg")
        .attr("width", w)
        .attr("height", h);

    // Create rect outlining entire area of SVG
    /*plot_svg.append("rect")
        .attr("x", 0)
        .attr("y", 0)
        .attr("width", w)
        .attr("height", h)
        .attr("fill", "lavender");*/
        
    // Create scale for X axis
    var xscale = d3.scaleLinear()
        .domain([starting_year, ending_year])   // recalculated in refreshPlot()
        .range([padding, w - padding]);

    // Create scale for Y axis
    var yscale = d3.scaleLinear()
        .domain([0, 1])
        .range([h - padding, padding]);

    // Create scale for drawing line segments
    var line_scale = d3.scaleBand()
        .domain(d3.range(nsegments))
        .range(xscale.domain());
        
    // Create dots that represent empirical estimates of the frequency of the 
    // melanic form at each year
    var dots = svg.selectAll("circle.dots")
        .data(fraction_carbonaria)
        .enter()
        .append("circle")
        .attr("class", "dots")
        .attr("cx", function(d) {return xscale(d.year);})
        .attr("cy", function(d) {return yscale(d.fraction);})
        .attr("r", dot_radius)
        .attr("fill", "black");

    // Function that recalculates the line segments making up the transition probability curve
    function recalcLineData() {
        linedata = [];
        melanic_freq = starting_melanic_freq; // frequency of BB + Bb genotypes (melanic phenotype)
        let q = Math.sqrt(1. - melanic_freq);
        let p = 1.0 - q;
        let wBB = 1.0 - s0;
        let wBb = 1.0 - s0;
        let wbb = 1.0;
        for (var g = 0; g < nsegments; g++) {
            if (g == switch_year - starting_year) {
                wBB = 1.0 - s1;
                wBb = 1.0 - s1;
                wbb = 1.0;
            }
            
            // zygote genotype frequencies (before selection)
            pp = p*p;
            qq = q*q;
            pq2 = 1.0 - pp - qq;
            
            // mean relative fitness
            let wmean = pp*wBB + pq2*wBb + qq*(wbb);
            
            // parental genotype frequencies (after selection)
            pp  = pp*wBB/wmean;                                                   
            pq2 = pq2*wBb/wmean;                                                   
            qq  = qq*wbb/wmean;  
            
            // allele frequencies in gamete pool
            p = pp + pq2/2.0;                                           
            q = 1.0 - p;
            
            // frequency of melanic phenotype in generation g+1
            melanic_freq = p*p + 2.0*p*q;                                           
            linedata.push({'x':line_scale(g), 'y':melanic_freq});
        }
    }
    recalcLineData();

    // Create path representing frequency of melanic phenotype
    var lineFunc = d3.line()
        .x(function(d) {return xscale(d.x);})
        .y(function(d) {return yscale(d.y);});

    var phenotype_tragectory = svg.append("path")
        .attr("id", "trajectory")
        .attr("d", lineFunc(linedata))
        .attr("fill", "none")
        .attr("stroke", brickred)
        .attr("stroke-width", 2)
        .style("pointer-events", "none");   // don't want line intercepting drag events
        
    // Create text element showing final frequency of melanic phenotype
    var melanic_ending_freq = svg.append("text")
        .attr("id", "endfreq")
        .attr("x", w - padding + 20)
        .attr("y", yscale(melanic_freq))
        .text(" " + melanic_freq.toFixed(3));

    // Create x axis
    var xaxis = d3.axisBottom(xscale)
        .ticks(5)
        .tickFormat(d3.format("d"));

    // Add x axis to svg
    svg.append("g")
        .attr("id", "xaxis")
        .attr("class", "axis")
        .attr("transform", "translate(0," + (h - padding) + ")")
        .call(xaxis);

    // Style the x-axis
    svg.selectAll('.axis line, .axis path')
        .style('stroke', 'black')
        .style('fill', 'none')
        .style('stroke-width', '1px')
        .style('shape-rendering', 'crispEdges');
    svg.selectAll('g#xaxis g.tick text')
        .style('font-family', 'Helvetica')
        .style('font-size', axis_label_height_pixels);

    // Create y axis
    var yaxis = d3.axisLeft(yscale)
        .ticks(4)
        .tickFormat(d3.format(".2f"));

    // Add y axis to svg
    svg.append("g")
        .attr("id", "yaxis")
        .attr("class", "axis")
        .attr("transform", "translate(" + padding + ",0)")
        .call(yaxis);

    // Style the y-axis
    svg.selectAll('.axis line, .axis path')
        .style('stroke', 'black')
        .style('fill', 'none')
        .style('stroke-width', '1px')
        .style('shape-rendering', 'crispEdges');
    svg.selectAll('g#xaxis g.tick text')
        .style('font-family', 'Helvetica')
        .style('font-size', axis_label_height_pixels);
        
    var addSlider = function(panel, id, label, starting_value, onfunc) {
        var control_div = panel.append("div").append("div")
            .attr("id", id)
            .attr("class", "control");
        control_div.append("input")
            .attr("id", id)
            .attr("type", "range")
            .attr("name", id)
            .attr("min", "0")
            .attr("max", "100")
            .attr("value", starting_value)
            .on("input", onfunc);
        control_div.append("label")
            .append("label")
            .attr("id", id)
            .html("&nbsp;" + label);
        }
        
    var addCheckbox = function(panel, id, label, checked_by_default, onfunc) {
        var control_div = panel.append("div").append("div")
            .attr("id", id)
            .attr("class", "control");
        control_div.append("input")
            .attr("id", id)
            .attr("type", "checkbox")
            .property("checked", checked_by_default)
            .on("change", onfunc);
        control_div.append("label")
            .append("label")
            .html("&nbsp;" + label);
        }
        
    addCheckbox(ctrl_div, "lockcoeffs", "Selection coefficient constant", true, function() {
        var is_linked = d3.select(this).property('checked');
        if (is_linked) {
            // slinked going from false to true
            slinked = true;
            
            // modify sliders and trajectory to reflect average
            let pct0 = parseFloat(d3.select("input#early").property('value'));
            let pct1 = parseFloat(d3.select("input#late").property('value'));
            let pct = (pct0 + pct1)/2.0;
            adjustSliders(pct, 2);
        }
        else {
            // slinked going from true to false
            slinked = false;
            
            // no modification of sliders or trajectory is necessary
        }
    });
        
    function adjustSliders(pct, which) {
        // If which == 0, the early selection coefficient slider has changed
        // If which == 1, the late  selection coefficient slider has changed
        // If which == 2, both selection coefficient sliders have changed due to user checking the selection coefficient constant checkbox
        if (which > 1 && !slinked) {
            console.log("Error: which == " + which + " and slinked is false, which should not happen!");
        }
        
        // get selection coefficient from percentage
        s = pct/100;
        
        if (slinked) {
            s0 = s;
            s1 = s;
        }
        else {
            if (which == 0)
                s0 = s;
            else
                s1 = s;
        }
        
        // redo calculations with new s0
        recalcLineData();
        
        // change the labels on the sliders
        d3.select("label#early").text(" s (before " + switch_year + ") = " + s0.toFixed(3));
        d3.select("label#late").text(" s (after " + switch_year + ") = " + s1.toFixed(3));
        
        if (slinked) {
            // change value on other slider to match this slider
            if (which == 0)
                d3.select("input#late").property('value', pct);
            else if (which == 1)
                d3.select("input#early").property('value', pct);
            else {
                d3.select("input#early").property('value', pct);
                d3.select("input#late").property('value', pct);
            }
        }
        
        // change the label at the end of the line showing final melanic phenotype frequency
        melanic_ending_freq
            .attr("y", yscale(melanic_freq))
            .text(" " + melanic_freq.toFixed(3));
            
        // cause trajectory line to be redrawn by telling phenotype_tragectory
        // about the new linedata
        phenotype_tragectory.attr("d", lineFunc(linedata));
    }
        
    addSlider(ctrl_div, "early", " s (before " + switch_year + ") = " + s0.toFixed(3), 100.0*s0, function() {
        // get percentage from slider position
        let pct = parseFloat(d3.select(this).property('value'));
        adjustSliders(pct, 0);
        });

    addSlider(ctrl_div, "late", " s (after " + switch_year + ") = " + s1.toFixed(3), 100.0*s1, function() {
        // get percentage from slider position
        let pct = parseFloat(d3.select(this).property('value'));
        adjustSliders(pct, 1);
        });
        
    // Add explanatory text
    svg.append("text").attr("id", "info").attr("x",        xscale(1960)).attr("y", yscale(0.10)).text("Curve and points show frequency of melanic form from 1959 to 2003.");
    svg.append("text").attr("id", "w1").attr("x",          xscale(1960)).attr("y", yscale(0.50)).text("BB fitness = 1 - s");
    svg.append("text").attr("id", "w2").attr("x",          xscale(1960)).attr("y", yscale(0.45)).text("Bb fitness = 1 - s");
    svg.append("text").attr("id", "w3").attr("x",          xscale(1960)).attr("y", yscale(0.40)).text("bb fitness = 1");
    svg.append("text").attr("id", "darkallele").attr("x",  xscale(1960)).attr("y", yscale(0.30)).text("B: dominant melanic allele");
    svg.append("text").attr("id", "lightallele").attr("x", xscale(1960)).attr("y", yscale(0.25)).text("b: recessive non-melanic allele");

</script>

<p>The data for the points are from Clarke, Cyril A., Bruce Grant, Frieda M. M. Clarke, and 
Takahiro Asami. 1994. A long term assessment of <em>Biston betularia</em> (L.) in one UK locality 
(Caldy Common near West Kirby, Wirral), 1959-1993, and glimpses elsewhere. The Linnean 10(2):18-26.
Only data from mercury vapor lights was used from Appendix I. Values after 1993 were obtained by 
eye-balling Figure 2 in Cook, Laurence M. 2003. The rise and fall of 
the <em>carbonaria</em> form of the peppered moth. Quarterly Review of Biology 
78(4):399-417.</p>

      </div>
    </main><footer class="site-footer h-card">
  <data class="u-url" href="/"></data>

  <div class="wrapper">

    <h2 class="footer-heading">Paul O. Lewis Lab Home</h2>

    <div class="footer-col-wrapper">
      <div class="footer-col footer-col-1">
        <ul class="contact-list">
          <li class="p-name">Paul O. Lewis Lab Home</li><li><a class="u-email" href="mailto:paul.lewis@uconn.edu">paul.lewis@uconn.edu</a></li></ul>
      </div>

      <div class="footer-col footer-col-2"><ul class="social-media-list"><li><a href="https://github.com/plewis"><svg class="svg-icon"><use xlink:href="/assets/minima-social-icons.svg#github"></use></svg> <span class="username">plewis</span></a></li><li><a href="https://www.twitter.com/polewis"><svg class="svg-icon"><use xlink:href="/assets/minima-social-icons.svg#twitter"></use></svg> <span class="username">polewis</span></a></li></ul>
</div>

      <div class="footer-col footer-col-3">
        <p>This is the web site of Paul O. Lewis, Department of Ecology and Evolutionary Biology, University of Connecticut, Storrs, CT. USA.</p>
      </div>
    </div>

  </div>

</footer>
</body>

</html>
