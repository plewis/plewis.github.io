<!DOCTYPE html>
<html lang="en">

    <script type="text/x-mathjax-config">
        MathJax.Hub.Config({
          tex2jax: {
            inlineMath: [['$','$'], ['\\(','\\)']],
            processEscapes: true
          }
        });
    </script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.0/MathJax.js?config=TeX-AMS-MML_HTMLorMML" type="text/javascript"></script><head>
    <meta charset="utf-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1"><!-- Begin Jekyll SEO tag v2.8.0 -->
<title>Effects of Repeated Selfing | Paul O. Lewis Lab Home</title>
<meta name="generator" content="Jekyll v3.9.1" />
<meta property="og:title" content="Effects of Repeated Selfing" />
<meta property="og:locale" content="en_US" />
<meta name="description" content="This is the web site of Paul O. Lewis, Department of Ecology and Evolutionary Biology, University of Connecticut, Storrs, CT. USA." />
<meta property="og:description" content="This is the web site of Paul O. Lewis, Department of Ecology and Evolutionary Biology, University of Connecticut, Storrs, CT. USA." />
<link rel="canonical" href="http://localhost:4000/applets/selfing/" />
<meta property="og:url" content="http://localhost:4000/applets/selfing/" />
<meta property="og:site_name" content="Paul O. Lewis Lab Home" />
<meta property="og:type" content="website" />
<meta name="twitter:card" content="summary" />
<meta property="twitter:title" content="Effects of Repeated Selfing" />
<script type="application/ld+json">
{"@context":"https://schema.org","@type":"WebPage","description":"This is the web site of Paul O. Lewis, Department of Ecology and Evolutionary Biology, University of Connecticut, Storrs, CT. USA.","headline":"Effects of Repeated Selfing","url":"http://localhost:4000/applets/selfing/"}</script>
<!-- End Jekyll SEO tag -->
<link rel="stylesheet" href="/assets/main.css">
    <link rel="icon" type="image/png" href="/assets/img/favicon.png"><link type="application/atom+xml" rel="alternate" href="http://localhost:4000/feed.xml" title="Paul O. Lewis Lab Home" /><script type="text/javascript" charset="utf-8" src=/assets/js/center-text.js></script> 
    <script type="text/javascript" charset="utf-8" src=/assets/js/lgamma.js></script> 
    <script type="text/javascript" charset="utf-8" src=/assets/js/d3-3d.js></script> 
    <script type="text/javascript" charset="utf-8" src=/assets/js/d3.min.js></script> 
    <script type="text/javascript" charset="utf-8" src=/assets/js/mathfn-incbeta.js></script>
    <script type="text/javascript" charset="utf-8" src=/assets/js/random-0.26.js></script>
    <script type="text/javascript" charset="utf-8" src=/assets/js/POLPanel.js></script>
    <script type="text/javascript" charset="utf-8" src=/assets/js/POLTree.js></script>
    <style type="text/css">
        /* https://stackoverflow.com/questions/826782/how-to-disable-text-selection-highlighting */
        /* <p class="noselect">Unselectable text</p> */
        .noselect {
          -webkit-touch-callout: none; /* iOS Safari */
            -webkit-user-select: none; /* Safari */
             -khtml-user-select: none; /* Konqueror HTML */
               -moz-user-select: none; /* Firefox */
                -ms-user-select: none; /* Internet Explorer/Edge */
                    user-select: none; /* Non-prefixed version, currently
                                          supported by Chrome and Opera */
            }
    </style>
</head>
<body><header class="site-header" role="banner">

  <div class="wrapper"><a class="site-title" rel="author" href="/">Paul O. Lewis Lab Home</a><nav class="site-nav">
        <input type="checkbox" id="nav-trigger" class="nav-trigger" />
        <label for="nav-trigger">
          <span class="menu-icon">
            <svg viewBox="0 0 18 15" width="18px" height="15px">
              <path d="M18,1.484c0,0.82-0.665,1.484-1.484,1.484H1.484C0.665,2.969,0,2.304,0,1.484l0,0C0,0.665,0.665,0,1.484,0 h15.032C17.335,0,18,0.665,18,1.484L18,1.484z M18,7.516C18,8.335,17.335,9,16.516,9H1.484C0.665,9,0,8.335,0,7.516l0,0 c0-0.82,0.665-1.484,1.484-1.484h15.032C17.335,6.031,18,6.696,18,7.516L18,7.516z M18,13.516C18,14.335,17.335,15,16.516,15H1.484 C0.665,15,0,14.335,0,13.516l0,0c0-0.82,0.665-1.483,1.484-1.483h15.032C17.335,12.031,18,12.695,18,13.516L18,13.516z"/>
            </svg>
          </span>
        </label>

        <div class="trigger"><a class="page-link" href="/publications/">Publications</a><a class="page-link" href="/software/">Software</a><a class="page-link" href="/people/">People</a><a class="page-link" href="/teaching/">Teaching</a></div>
      </nav></div>
</header>
<main class="page-content" aria-label="Content">
      <div class="wrapper">
        <h2 id="effects-of-repeated-selfing">Effects of repeated selfing</h2>

<p>Key to genotype colors:</p>
<ul>
  <li><img src="https://via.placeholder.com/20.png/FEFF0B/000000?text=+" alt="" /> AA (yellow)</li>
  <li><img src="https://via.placeholder.com/20.png/F08D08/000000?text=+" alt="" /> Aa (orange)</li>
  <li><img src="https://via.placeholder.com/20.png/FF0000/FFFFFF?text=+" alt="" /> aa (red)</li>
</ul>

<p>The starting frequencies of AA, Aa, and aa are 0.25, 0.5, and 0.25, respectively. 
Press the “n” key to advance to the next generation. Repeat to see heterozygosity decrease to zero. 
Refresh your browser to start over.</p>

<div id="arbitrary"></div>
<script type="text/javascript">
    // The MIT License (MIT)
    // 
    // Copyright (c) 2019 Paul O. Lewis
    // 
    // Permission is hereby granted, free of charge, to any person obtaining a copy
    // of this software and associated documentation files (the “Software”), to deal
    // in the Software without restriction, including without limitation the rights
    // to use, copy, modify, merge, publish, distribute, sublicense, and/or sell
    // copies of the Software, and to permit persons to whom the Software is
    // furnished to do so, subject to the following conditions:
    // 
    // The above copyright notice and this permission notice shall be included in all
    // copies or substantial portions of the Software.
    // 
    // THE SOFTWARE IS PROVIDED “AS IS”, WITHOUT WARRANTY OF ANY KIND, EXPRESS OR
    // IMPLIED, INCLUDING BUT NOT LIMITED TO THE WARRANTIES OF MERCHANTABILITY,
    // FITNESS FOR A PARTICULAR PURPOSE AND NONINFRINGEMENT. IN NO EVENT SHALL THE
    // AUTHORS OR COPYRIGHT HOLDERS BE LIABLE FOR ANY CLAIM, DAMAGES OR OTHER
    // LIABILITY, WHETHER IN AN ACTION OF CONTRACT, TORT OR OTHERWISE, ARISING FROM,
    // OUT OF OR IN CONNECTION WITH THE SOFTWARE OR THE USE OR OTHER DEALINGS IN THE
    // SOFTWARE.
    // 
    // written by Paul O. Lewis 10-Apr-2019
    
    // width and height of svg
    var plot_w = 600;
    var plot_h = 600;
    var status_h = 50;
    
    // There indivrows x indivcols diploid individuals
    var indivrows = 16;
    var indivcols = 16;
    
    // Dimensions of cells in which individuals are shown
    var wcell = plot_w/indivcols;
    var hcell = plot_h/indivrows;
    var cell_avg_diam = (wcell + hcell)/2;
    
    // Radius of circle representing a single individual
    var rindiv = 0.3*cell_avg_diam;

    // Determines amount of Gaussian jigger to impart to each individual's position
    //var jigger_stdev = 0.3*cell_avg_diam;
    
    // Genotype colors
    var genotype_color = ["yellow", "orange", "red"];
    
    // Initialize heterozygosity and frequency of A allele
    var freqAA = 0.25;
    var freqAa = 0.50;
    var freqaa = 0.25;
    
    // Returns index into data vector of individual on row indivrow, column indivcol
    function getDataIndex(indivrow, indivcol) {
        return indivrow*indivcols + indivcol;
    }
    
    // Randomly draw a genotype given frequencies of AA, Aa, and aa.
    function drawOneGenotype(pp, pq2, qq, self_fertilize) {
        let u = Math.random();
        if (u < pp)
            return 0;
        else if (u < pp + pq2) {
            if (self_fertilize) {
                let uu = Math.random();
                if (uu < 0.25)
                    return 0;
                else if (uu < 0.75)
                    return 1;
                else
                    return 2;
                }
            else
                return 1;
            }
        else
            return 2;
    }
    
    // Draw n genotypes
    function drawNGenotypes(n, self_fertilize, initialize) {
        let v = [];
        let nTotal = 0;
        let nAA = 0;
        let nAa = 0;
        let naa = 0;
        if (initialize) {
            nTotal = indivrows*indivcols;
            nAA = Math.floor(0.25*nTotal);
            nAa = Math.floor(0.5*nTotal);
            naa = Math.floor(0.25*nTotal);
            if (nAA + nAa + naa != nTotal) {
                console.log("ERROR: number of individuals in each population should be a multiple of 4");
            }
            for (let i = 0; i < nAA; i++) {
                v.push(0);
            }
            for (let i = 0; i < nAa; i++) {
                v.push(1);
            }
            for (let i = 0; i < naa; i++) {
                v.push(2);
            }
        }
        else {
            for (k = 0; k < n; k++) {
                let g = drawOneGenotype(freqAA, freqAa, freqaa, self_fertilize);
                v.push(g);
                if (g == 0)
                    nAA++;
                else if (g == 1)
                    nAa++;
                else 
                    naa++;
            }
            nTotal = nAA + nAa + naa;
        }
        freqAA = nAA/nTotal;
        freqAa = nAa/nTotal;
        freqaa = naa/nTotal;
        return v;
    }   
    
    function getCellX(indivcol) {
        return wcell*(indivcol + 0.5);
    }       
    
    function getCellY(indivrow) {
        return status_h + hcell*(indivrow + 0.5);
    }       
    
    // Data for individuals is stored as list of objects containing information about each individual
    var indiv_data = [];
    let n = indivrows*indivcols;
    let v = drawNGenotypes(n, false, true);
    for (let i = 0; i < indivrows; i++) {
        for (let j = 0; j < indivcols; j++) {
            let x = getCellX(j);
            let y = getCellY(i);
            indiv_data.push({"i":i, "j":j, "x":x, "y":y, "genotype":v[i*indivcols + j]});
        }
    }
    
    function getStatusText() {
        return "AA = " + freqAA.toFixed(3) + ", Aa = " + freqAa.toFixed(3) + ", aa = " + freqaa.toFixed(3);
    }
    
    function nextGeneration() {
        let n = indivrows*indivcols;
        let v = drawNGenotypes(n, true, false);
        for (let i = 0; i < indivrows; i++) {
            for (let j = 0; j < indivcols; j++) {
                let x = getCellX(j);
                let y = getCellY(i);
                let indiv = getDataIndex(i, j);
                indiv_data[indiv].genotype = v[i*indivcols + j];
            }
        }
        d3.selectAll("circle.indiv")
            .attr("cx", function(d) {return d.x;})
            .attr("cy", function(d) {return d.y;})
            .attr("fill", function(d) {return genotype_color[d.genotype];});
        d3.select("text#status")
            .text(getStatusText());
        CenterTextInRect(status_text, 0, 0, plot_w, status_h);                 
    }
    
    // Data for lines surrounding population
    var line_data = [];
    
    // top
    let x1 = 0;
    let x2 = plot_w;
    let y1 = status_h;
    let y2 = status_h;
    line_data.push({"x1":x1, "x2":x2, "y1":y1, "y2":y2});

    // bottom
    x1 = 0;
    x2 = plot_w;
    y1 = status_h + plot_h;
    y2 = status_h + plot_h;
    line_data.push({"x1":x1, "x2":x2, "y1":y1, "y2":y2});

    // left
    x1 = 0;
    x2 = 0;
    y1 = status_h;
    y2 = status_h + plot_h;
    line_data.push({"x1":x1, "x2":x2, "y1":y1, "y2":y2});
    
    // right
    x1 = plot_w;
    x2 = plot_w;
    y1 = status_h;
    y2 = status_h + plot_h;
    line_data.push({"x1":x1, "x2":x2, "y1":y1, "y2":y2});
    
    function CenterTextInRect(text_element, x, y, w, h) {
        // center text_element horizontally
        text_element.attr("text-anchor", "middle");
        text_element.attr("x", x + w/2);

        // center text_element vertically
        text_element.attr("y", 0);
        var bb = text_element.node().getBBox();
        var descent = bb.height + bb.y;
        text_element.attr("y", y + h/2 + bb.height/2 - descent);
        }

    // Listen and react to keystrokes
    function keyDown() {
        console.log("key was pressed: " + d3.event.keyCode);
        if (d3.event.keyCode == 78) {
            // 78 is the "n" key
            nextGeneration();
        }
    }
    d3.select("body")
        .on("keydown", keyDown);

    // Select DIV element already created (see above) to hold SVG
    var plot_div = d3.select("div#arbitrary");

    // Create SVG element
    var plot_svg = plot_div.append("svg")
        .attr("width", plot_w)
        .attr("height", plot_h + status_h);

    // Create rect outlining entire area of SVG
    plot_svg.append("rect")
        .attr("x", 0)
        .attr("y", status_h)
        .attr("width", plot_w)
        .attr("height", plot_h + status_h)
        .attr("fill", "lavender");
        
    // Create circles representing individuals
    plot_svg.selectAll("circle.indiv")
        .data(indiv_data)
        .enter()
        .append("circle")
        .attr("class", "indiv")
        .attr("cx", function(d) {return d.x;})
        .attr("cy", function(d) {return d.y;})
        .attr("r", rindiv)
        .attr("fill", function(d) {return genotype_color[d.genotype];})
        .attr("stroke", "black");

    // Create blue line from center of plot area to right edge
    plot_svg.selectAll("line.popbounds")
        .data(line_data)
        .enter()
        .append("line")
        .attr("class", "popbounds")
        .attr("x1", function(d) {return d.x1;})
        .attr("y1", function(d) {return d.y1;})
        .attr("x2", function(d) {return d.x2;})
        .attr("y2", function(d) {return d.y2;})
        .attr("stroke", "black");
        
    var status_text = plot_svg.append("text")
        .attr("id", "status")
        .attr("x", plot_w/2)
        .attr("y", status_h/2)
        .attr("font-family", "Verdana")
        .attr("font-size", "12pt")
        .text(getStatusText());
    CenterTextInRect(status_text, 0, 0, plot_w, status_h);                 
</script>


      </div>
    </main><footer class="site-footer h-card">
  <data class="u-url" href="/"></data>

  <div class="wrapper">

    <h2 class="footer-heading">Paul O. Lewis Lab Home</h2>

    <div class="footer-col-wrapper">
      <div class="footer-col footer-col-1">
        <ul class="contact-list">
          <li class="p-name">Paul O. Lewis Lab Home</li><li><a class="u-email" href="mailto:paul.lewis@uconn.edu">paul.lewis@uconn.edu</a></li></ul>
      </div>

      <div class="footer-col footer-col-2"><ul class="social-media-list"><li><a href="https://github.com/plewis"><svg class="svg-icon"><use xlink:href="/assets/minima-social-icons.svg#github"></use></svg> <span class="username">plewis</span></a></li><li><a href="https://www.twitter.com/polewis"><svg class="svg-icon"><use xlink:href="/assets/minima-social-icons.svg#twitter"></use></svg> <span class="username">polewis</span></a></li></ul>
</div>

      <div class="footer-col footer-col-3">
        <p>This is the web site of Paul O. Lewis, Department of Ecology and Evolutionary Biology, University of Connecticut, Storrs, CT. USA.</p>
      </div>
    </div>

  </div>

</footer>
</body>

</html>
